// TimeoutFlow - Fluent timer + RAF control library
var K=t=>{throw TypeError(t)};var G=(t,e,n)=>e.has(t)||K("Cannot "+n);var l=(t,e,n)=>(G(t,e,"read from private field"),n?n.call(t):e.get(t)),y=(t,e,n)=>e.has(t)?K("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,n),c=(t,e,n,i)=>(G(t,e,"write to private field"),i?i.call(t,n):e.set(t,n),n),B=(t,e,n)=>(G(t,e,"access private method"),n);var Q=(t,e,n,i)=>({set _(o){c(t,e,o,n)},get _(){return l(t,e,i)}});var U={ms:1,s:1e3,m:6e4,h:36e5};function p(t){if(typeof t=="number"&&Number.isFinite(t))return t;if(typeof t!="string")throw new TypeError(`Expected a duration string or number, got ${typeof t}`);t=t.toLowerCase().trim();let e=t.match(/^(\d+(?:\.\d+)?)\s*(ms|s|m|h)$/);if(!e)throw new Error(`Invalid duration format: "${t}". Expected formats like "500ms", "2s", "1.5m", or "1h".`);let[,n,i]=e;return parseFloat(n)*U[i]}var $,L,k,R,F,b,q,C,S,W=class{constructor(e,n,i=1/0,o=!1){y(this,C);y(this,$);y(this,L);y(this,k);y(this,R,0);y(this,F,!1);y(this,b,null);y(this,q,()=>{var e;if(l(this,R)>=l(this,k)){this.cancel();return}(e=l(this,L))==null||e.call(this,Q(this,R)._++),B(this,C,S).call(this)});c(this,$,p(e)),c(this,L,n),c(this,k,i),o?l(this,q).call(this):B(this,C,S).call(this)}get count(){return l(this,R)}get isRunning(){return l(this,F)}pause(){l(this,b)?.pause(),c(this,F,!1)}resume(){!l(this,F)&&l(this,R)<l(this,k)&&(l(this,b)?.resume(l(this,q)),c(this,F,!0))}cancel(){l(this,b)?.cancel(),c(this,F,!1)}reset(e=!1){this.cancel(),c(this,R,0),e&&B(this,C,S).call(this)}};$=new WeakMap,L=new WeakMap,k=new WeakMap,R=new WeakMap,F=new WeakMap,b=new WeakMap,q=new WeakMap,C=new WeakSet,S=function(){c(this,b,new E(l(this,$))),c(this,F,!0),l(this,b).resume(l(this,q))};var M,N,v,I,D,E=class{constructor(e){y(this,M);y(this,N,null);y(this,v);y(this,I,null);y(this,D,!1);c(this,M,p(e)),c(this,v,l(this,M))}get isRunning(){return l(this,D)}pause(){l(this,D)&&(clearTimeout(l(this,I)),c(this,v,l(this,v)-(Date.now()-l(this,N))),c(this,D,!1))}resume(e,n=null){!l(this,D)&&l(this,v)>0&&(c(this,N,Date.now()),c(this,D,!0),c(this,I,setTimeout(()=>{c(this,D,!1),e?.()},n??l(this,v))))}cancel(){clearTimeout(l(this,I)),c(this,D,!1),c(this,I,null)}reset(){this.cancel(),c(this,v,l(this,M))}};M=new WeakMap,N=new WeakMap,v=new WeakMap,I=new WeakMap,D=new WeakMap;var z=class extends E{constructor(e,n,i){super(e),this.resume(()=>{n?.(),i?.()})}};function H(t,e,n){return new z(t,e,n)}function J(t,e,n=1/0,i=!1){return new W(t,e,n,i)}function V(){let t=[],e=0,n=!1,i=!1,o=!1,s=1/0,u=0,f=null,a=new Map,m=null,d=[],x=!1,T=null,A=null,w={after(r,h){return t.push({type:"after",duration:r,fn:h}),w},every(r,h,_=1/0){return t.push({type:"every",duration:r,fn:h,times:_,whileCondition:T,doWhileCondition:A}),T=null,A=null,w},loop(r=!0){return o=!0,s=r===!0?1/0:r,w},onFinish(r){return f=r,w},start(){return i=!1,n=!1,e=0,u=0,P(),w},pause(){n||i||(n=!0,t[e]?.controller?.pause?.())},resume(){!n||i||(n=!1,t[e]?.controller?.resume?.())},cancel(){i=!0;let r=t[e];r?.controller?.cancel?.(),r.controller=null},reset(){return w.cancel(),t.length=0,e=0,u=0,f=null,w},get isPaused(){return n},label(r){return a.set(r,t.length),w},jumpTo(r){return m=r,w},if(r){return d.push(()=>typeof r=="function"?r():!!r),w},unless(r){return d.push(()=>!(typeof r=="function"?r():r)),w},while(r){return T=()=>typeof r=="function"?r():!!r,w},doWhile(r){return A=()=>typeof r=="function"?r():!!r,w}};function g(r=null){r?.controller&&(r.controller=null),e++,P()}function P(){if(i||n)return;if(m){let h=a.get(m);if(typeof h=="number")e=h;else throw new Error(`Label "${m}" not found`);m=null}if(d.length>0&&(d.shift()()||(x=!0)),x){let h=t[e];if(!h||h.type==="label")x=!1;else return g(r)}let r=t[e];if(!r||e>=t.length){o&&++u<s?(e=0,P()):f?.();return}if(r.type==="after"){r.controller=H(r.duration,r.fn,()=>g(r));return}if(r.type==="every"){let h=0,_=!0,j=J(r.duration,()=>{if(!(n||i)&&(r.whileCondition&&!r.whileCondition()||(r.fn(h++),_=!1,!_&&r.doWhileCondition&&!r.doWhileCondition())||h>=r.times))return j.cancel(),g(r)},r.times);r.controller=j}if(r.type==="label")return g(r)}return w}function X(t,e,{leading:n=!0}={}){let i=p(t),o=0;return(...s)=>{let u=Date.now();if(n&&o===0)return o=u,e(...s);u-o>=i&&(o=u,e(...s))}}function Y(t,e){let n=p(t),i=null;return(...o)=>{clearTimeout(i),i=setTimeout(()=>e(...o),n)}}function Z(t,{interval:e="250ms",timeout:n}={}){return new Promise((i,o)=>{let s=Date.now(),u=typeof e=="string"?parseDuration(e):e,f=n?parseDuration(n):null,m=setInterval(()=>{t()?(clearInterval(m),i()):f&&Date.now()-s>=f&&(clearInterval(m),o(new Error("waitFor timed out")))},u)})}async function O(t,{attempts:e=3,delay:n="500ms",backoff:i=!1}={}){let o=p(n);for(let s=0;s<e;s++)try{return await t()}catch(u){if(s===e-1)throw u;let f=i?o*Math.pow(2,s):o;await new Promise(a=>setTimeout(a,f))}}function ee(t,e,n){let i=typeof t=="string"?p(t):t,o=null,s=null,u=null,f=0,a=!0,m=A=>{if(!a)return;s==null&&(s=A),A-s+f>=i?(a=!1,e?.(),n?.()):o=requestAnimationFrame(m)},d=()=>{a&&o!==null&&(cancelAnimationFrame(o),u=performance.now(),a=!1)},x=()=>{!a&&u!==null&&(f+=performance.now()-u,a=!0,o=requestAnimationFrame(m))},T=()=>{o!==null&&(cancelAnimationFrame(o),o=null),a=!1};return o=requestAnimationFrame(m),{pause:d,resume:x,cancel:T,get isRunning(){return a}}}function te(t,e,n=1/0,i=!1){let o=typeof t=="string"?p(t):t,s=null,u=null,f=null,a=!1,m=!1,d=0,x=0,T=h=>{if(!a||m)return;if(u==null&&(u=h,f=h),h-f+d>=o){if(x>=n){g();return}e?.(),x++,f=h,d=0}s=requestAnimationFrame(T)},A=()=>{a&&!m&&(m=!0,d+=performance.now()-f,cancelAnimationFrame(s))},w=()=>{a&&m&&(m=!1,f=performance.now(),s=requestAnimationFrame(T))},g=()=>{s!==null&&(cancelAnimationFrame(s),s=null),a=!1,m=!1,u=null,f=null,d=0},P=(h=!1)=>{g(),x=0,h&&r()},r=()=>{i&&(e?.(),x++),a=!0,m=!1,f=performance.now(),s=requestAnimationFrame(T)};return r(),{pause:A,resume:w,cancel:g,reset:P,get isRunning(){return a&&!m},get count(){return x}}}function re(t,e){let[n,i]=typeof t=="function"?[0,t]:[p(t),e],o=null,s=null,u=0,f=a=>{a-u>=n?(i(...s),o=null):o=requestAnimationFrame(f)};return(...a)=>{s=a,u=performance.now(),o!==null&&cancelAnimationFrame(o),o=requestAnimationFrame(f)}}function ne(t,e=0){let n=!1,i=null,o=0;return(...s)=>{i=s,n||(n=!0,requestAnimationFrame(function u(){o>=e?(t(...i),o=0,n=!1):(o++,requestAnimationFrame(u))}))}}function oe(t,{timeout:e}={}){return new Promise((n,i)=>{let o=performance.now(),s=e?p(e):null,u=f=>{if(t())return n();if(s&&f-o>=s)return i(new Error("waitForRaf timed out"));requestAnimationFrame(u)};requestAnimationFrame(u)})}export{H as after,ee as afterRaf,Y as debounce,re as debounceRaf,J as every,te as everyRaf,V as flow,p as parseDuration,O as retry,X as throttle,ne as throttleRaf,Z as waitFor,oe as waitForRaf};
